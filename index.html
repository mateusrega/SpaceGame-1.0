<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>SpaceGame Mobile 2.0</title>
<style>
  html,body{margin:0;padding:0;height:100%;background:#071020;overflow:hidden;font-family:sans-serif;color:#dfeffb;}
  canvas{display:block;}
  #joystick-area{position:absolute;bottom:20px;left:20px;width:120px;height:120px;border-radius:50%;background:rgba(255,255,255,0.1);}
  #joystick-stick{position:absolute;width:40px;height:40px;border-radius:50%;background:lime;top:40px;left:40px;pointer-events:none;}
  #ui{position:absolute;top:10px;left:10px;}
  .hud-item{margin:2px 0;}
  .btn{padding:4px 8px;margin-right:4px;background:#0c1420;color:#4fb3ff;border:none;border-radius:4px;}
</style>
</head>
<body>

<canvas id="canvas"></canvas>

<div id="ui">
  <div class="hud-item" id="velocidade">Velocidade: 0</div>
  <div class="hud-item" id="coordX">X: 0</div>
  <div class="hud-item" id="coordY">Y: 0</div>
  <div class="hud-item" id="turbo"></div>
  <button class="btn" id="btnTurbo">TURBO</button>
  <button class="btn" id="btnMinimap">MAP</button>
  <button class="btn" id="btnPause">PAUSA</button>
  <button class="btn" id="btnReset">RESET</button>
</div>

<div id="joystick-area">
  <div id="joystick-stick"></div>
</div>

<script>
  // Canvas
  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");
  function resizeCanvas(){canvas.width=window.innerWidth;canvas.height=window.innerHeight;}
  window.addEventListener("resize",resizeCanvas); resizeCanvas();

  // Game state
  const worldRadius = 100000;
  const player = { x:0,y:0,vx:0,vy:0,angle:11 };
  let maxSpeed = 50;
  let turboEnabled=false,minimapEnabled=false,paused=false;

  // Buttons
  const btnTurbo=document.getElementById("btnTurbo");
  const btnMinimap=document.getElementById("btnMinimap");
  const btnPause=document.getElementById("btnPause");
  const btnReset=document.getElementById("btnReset");

  function updateButtonLabels(){
    btnTurbo.textContent = turboEnabled ? "TURBO ON":"TURBO";
    btnMinimap.textContent = minimapEnabled ? "MAP ON":"MAP";
    btnPause.textContent = paused ? "CONTINUAR":"PAUSA";
  }
  btnTurbo.addEventListener("touchstart",(e)=>{e.preventDefault(); turboEnabled=!turboEnabled; updateButtonLabels();},{passive:false});
  btnMinimap.addEventListener("touchstart",(e)=>{e.preventDefault(); minimapEnabled=!minimapEnabled; updateButtonLabels();},{passive:false});
  btnPause.addEventListener("touchstart",(e)=>{e.preventDefault(); paused=!paused; updateButtonLabels();},{passive:false});
  btnReset.addEventListener("touchstart",(e)=>{e.preventDefault(); player.x=0;player.y=0;player.vx=0;player.vy=0;player.angle=0;},{passive:false});
  updateButtonLabels();

  // Stars
  const stars=[];
  const starDensity=1.25e-5;
  const totalStars=Math.floor((worldRadius*2)**2*starDensity);
for (let i = 0; i < totalStars; i++) {
  stars.push({
    x: (Math.random() - 0.5) * worldRadius * 2,
    y: (Math.random() - 0.5) * worldRadius * 2,
    size: Math.random() * 5 + 1
  });
}// ============================
// Sistemas estelares centralizados
// ============================
const systems = [
  // Sistema Central (perto do spawn)
  {
    name: "Sistema Central",
    sun: { x: -53000, y: -500, mass: 2000, radius: 1500, color: "yellow" },
    planets: [
      { name: "Mercúrio", distance: 6000, speed: 0.0003, angle: Math.random()*Math.PI*2, radius: 200, color: "#E63946", mass: 30 },
      { name: "Vênus",    distance: 10000, speed: 0.0002, angle: Math.random()*Math.PI*2, radius: 350, color: "#1D3557", mass: 40 },
      { name: "Terra",    distance: 14000, speed: 0.00015, angle: Math.random()*Math.PI*2, radius: 400, color: "#6AFF00", mass: 40 },
      { name: "Marte",    distance: 18000, speed: 0.00012, angle: Math.random()*Math.PI*2, radius: 300, color: "#FF7F11", mass: 26 }
    ]
  },

  // Sistema Boreal
  {
    name: "Sistema Boreal",
    sun: { x: -70000, y: 80000, mass: 900, radius: 700, color: "#8FDBFF" },
    planets: [
      { name: "Aurion",  distance: 8000,  speed: 0.00022, angle: Math.random()*Math.PI*2, radius: 300, color: "#00F2FF", mass: 25 },
      { name: "Gelmare", distance: 13000, speed: 0.00018, angle: Math.random()*Math.PI*2, radius: 420, color: "#7FF6FF", mass: 32 },
      { name: "Kryst",   distance: 20000, speed: 0.00010, angle: Math.random()*Math.PI*2, radius: 600, color: "#AFFFFF", mass: 55 }
    ]
  },

  // Sistema Rubrum
  {
    name: "Sistema Rubrum",
    sun: { x: 80000, y: -70000, mass: 600, radius: 500, color: "#FF5C5C" },
    planets: [
      { name: "Scorn", distance: 5000, speed: 0.0003, angle: Math.random()*Math.PI*2, radius: 180, color: "#FF0000", mass: 20 },
      { name: "Balor", distance: 9000, speed: 0.00022, angle: Math.random()*Math.PI*2, radius: 300, color: "#FF7A00", mass: 28 },
      { name: "Vulcar",distance: 15000, speed: 0.00016, angle: Math.random()*Math.PI*2, radius: 450, color: "#FFA200", mass: 40 }
    ]
  },

  // Sistema Elyrium
  {
    name: "Sistema Elyrium",
    sun: { x: 60000, y: 90000, mass: 1200, radius: 950, color: "#D7F1FF" },
    planets: [
      { name: "Shyra",   distance: 9000,  speed: 0.00024, angle: Math.random()*Math.PI*2, radius: 260, color: "#FFF7C0", mass: 24 },
      { name: "Talyon",  distance: 17000, speed: 0.00018, angle: Math.random()*Math.PI*2, radius: 480, color: "#B8FF8E", mass: 45 },
      { name: "Friela",  distance: 26000, speed: 0.00011, angle: Math.random()*Math.PI*2, radius: 700, color: "#A0C5FF", mass: 70 }
    ]
  },

  // Sistema Arkan
  {
    name: "Sistema Arkan",
    sun: { x: -50000, y: -90000, mass: 800, radius: 600, color: "#FFB469" },
    planets: [
      { name: "Rakef",  distance: 7000,  speed: 0.00027, angle: Math.random()*Math.PI*2, radius: 220, color: "#FF9248", mass: 28 },
      { name: "Domare", distance: 13000, speed: 0.00019, angle: Math.random()*Math.PI*2, radius: 360, color: "#FFE560", mass: 40 },
      { name: "Garon",  distance: 21000, speed: 0.00013, angle: Math.random()*Math.PI*2, radius: 520, color: "#FFD299", mass: 55 }
    ]
  },

  // Sistema Colosso
  {
    name: "Sistema Colosso",
    sun: { x: 90000, y: 30000, mass: 4000, radius: 3000, color: "#FF6B6B" },
    planets: [
      { name: "Torun",   distance: 16000, speed: 0.00014, angle: Math.random()*Math.PI*2, radius: 600, color: "#FFD000", mass: 85 },
      { name: "Cryon",   distance: 30000, speed: 0.00010, angle: Math.random()*Math.PI*2, radius: 800, color: "#00FFE5", mass: 110 },
      { name: "Velkar",  distance: 45000, speed: 0.00007, angle: Math.random()*Math.PI*2, radius: 950, color: "#7F00FF", mass: 150 }
    ]
  }
];

  // Joystick
  const joyArea=document.getElementById("joystick-area");
  const joyStick=document.getElementById("joystick-stick");
  let joyCenter={x:0,y:0,r:60};
  let joyActive=false;
  const joystick={dx:0,dy:0,mag:0};

  function updateJoyCenter(){
    const r = joyArea.getBoundingClientRect();
    joyCenter.x = r.left+r.width/2;
    joyCenter.y = r.top+r.height/2;
    joyCenter.r = Math.min(r.width,r.height)*0.38;
  }
  updateJoyCenter();
  window.addEventListener("resize", updateJoyCenter);

  function joyStart(e){joyActive=true; handleJoyMove(e);}
  function joyMove(e){if(!joyActive) return; handleJoyMove(e); e.preventDefault && e.preventDefault();}
  function joyEnd(e){joyActive=false; joystick.dx=0;joystick.dy=0;joystick.mag=0; joyStick.style.transform=`translate(0px,0px)`;}

  function handleJoyMove(e){
    const touch=e.touches?e.touches[0]:e;
    let x=touch.clientX-joyCenter.x;
    let y=touch.clientY-joyCenter.y;
    const dist=Math.sqrt(x*x+y*y);
    const max=joyCenter.r||60;
    const clamped=dist>max?max:dist;
    joystick.dx=x/max; joystick.dy=y/max;
    joystick.mag=Math.min(dist/max,1);
    const tx=clamped*(x/(dist||1)), ty=clamped*(y/(dist||1));
    joyStick.style.transform=`translate(${tx}px,${ty}px)`;
  }
  joyArea.addEventListener("touchstart",joyStart,{passive:false});
  joyArea.addEventListener("touchmove",joyMove,{passive:false});
  joyArea.addEventListener("touchend",joyEnd,{passive:false});
  joyArea.addEventListener("touchcancel",joyEnd,{passive:false});

  // Helpers
  function normalizeAngle(a){while(a>Math.PI)a-=Math.PI*2;while(a<-Math.PI)a+=Math.PI*2;return a;}

  // Game update
  function update(){
    if(paused) return;
    const friction=0.999;
    const acceleration=turboEnabled?2:0.5;
    maxSpeed = turboEnabled?200:50;

    if(joystick.mag>0.03){
      const targetAngle=Math.atan2(joystick.dy,joystick.dx);
      const angDiff=normalizeAngle(targetAngle-player.angle);
      player.angle+=angDiff*0.25;
      const thrust=joystick.mag*acceleration;
      player.vx+=Math.cos(player.angle)*thrust;
      player.vy+=Math.sin(player.angle)*thrust;
    }

    // Limit speed
    let speed=Math.hypot(player.vx,player.vy);
    if(speed>maxSpeed){const scale=maxSpeed/speed; player.vx*=scale;player.vy*=scale;}

    // Gravity
    const G=500;
    const applyGravity=(m,x,y)=>{
      const dx=x-player.x, dy=y-player.y;
      const distSq=dx*dx+dy*dy; const dist=Math.sqrt(distSq);
      if(dist>20){
        const force=(G*m)/distSq;
        player.vx+=(dx/dist)*force; player.vy+=(dy/dist)*force;
      }
    };
    for(let system of systems){
      applyGravity(system.sun.mass, system.sun.x, system.sun.y);
      for(let planet of system.planets){
        const px=system.sun.x+planet.distance*Math.cos(planet.angle);
        const py=system.sun.y+planet.distance*Math.sin(planet.angle);
        applyGravity(planet.mass, px, py);
      }
    }

    // Move player
    player.vx*=friction; player.vy*=friction;
    player.x+=player.vx; player.y+=player.vy;

    // Collisions
    for(let system of systems){
      const sun=system.sun;
      const distSun=Math.hypot(player.x-sun.x,player.y-sun.y);
      if(distSun<sun.radius){
        const angleOut=Math.atan2(player.y-sun.y,player.x-sun.x);
        player.x=sun.x+Math.cos(angleOut)*(sun.radius+1);
        player.y=sun.y+Math.sin(angleOut)*(sun.radius+1);
        player.vx=0;player.vy=0;
      }
      for(let planet of system.planets){
        const px=sun.x+planet.distance*Math.cos(planet.angle);
        const py=sun.y+planet.distance*Math.sin(planet.angle);
        const d=Math.hypot(player.x-px,player.y-py);
        if(d<planet.radius){
          const angleOut=Math.atan2(player.y-py,player.x-px);
          player.x=px+Math.cos(angleOut)*planet.radius;
          player.y=py+Math.sin(angleOut)*planet.radius;
          const orbitalVx=-Math.sin(planet.angle)*planet.speed*planet.distance;
          const orbitalVy=Math.cos(planet.angle)*planet.speed*planet.distance;
          player.vx+=(orbitalVx-player.vx)*0.1;
          player.vy+=(orbitalVy-player.vy)*0.1;
          player.vx*=0.98; player.vy*=0.98;
        }
      }
    }

    // World borders
    if(player.x<-worldRadius){player.x=-worldRadius+1000;player.vx*=-1;}
    if(player.x>worldRadius){player.x=worldRadius-1000;player.vx*=-1;}
    if(player.y<-worldRadius){player.y=-worldRadius+1000;player.vy*=-1;}
    if(player.y>worldRadius){player.y=worldRadius-1000;player.vy*=-1;}

    // Advance planets
    for(let system of systems) for(let planet of system.planets) planet.angle+=planet.speed;
  }

  // Draw
  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    const offsetX=canvas.width/2-player.x;
    const offsetY=canvas.height/2-player.y;

    // Grid
    const gridSpacing=500, range=3000;
    const startX=Math.floor((player.x-range)/gridSpacing)*gridSpacing;
    const endX=Math.floor((player.x+range)/gridSpacing)*gridSpacing;
    const startY=Math.floor((player.y-range)/gridSpacing)*gridSpacing;
    const endY=Math.floor((player.y+range)/gridSpacing)*gridSpacing;
    ctx.strokeStyle="#222"; ctx.lineWidth=0.5;
    for(let x=startX;x<=endX;x+=gridSpacing){ctx.beginPath();ctx.moveTo(x+offsetX,0);ctx.lineTo(x+offsetX,canvas.height);ctx.stroke();}
    for(let y=startY;y<=endY;y+=gridSpacing){ctx.beginPath();ctx.moveTo(0,y+offsetY);ctx.lineTo(canvas.width,y+offsetY);ctx.stroke();}

    // Stars
    ctx.fillStyle="white";
    for(let star of stars){const sx=star.x+offsetX,sy=star.y+offsetY; if(sx>=-10 && sx<=canvas.width+10 && sy>=-10 && sy<=canvas.height+10){ctx.beginPath();ctx.arc(sx,sy,star.size,0,Math.PI*2);ctx.fill();}}

    // Systems
    for(let system of systems){
      const sun=system.sun;
      ctx.beginPath(); ctx.arc(sun.x+offsetX,sun.y+offsetY,sun.radius,0,Math.PI*2); ctx.fillStyle=sun.color; ctx.fill();
      for(let planet of system.planets){
        const x=sun.x+planet.distance*Math.cos(planet.angle);
        const y=sun.y+planet.distance*Math.sin(planet.angle);
        ctx.beginPath(); ctx.arc(x+offsetX,y+offsetY,planet.radius,0,Math.PI*2); ctx.fillStyle=planet.color; ctx.fill();
      }
    }

    // Ship
    ctx.save(); ctx.translate(canvas.width/2,canvas.height/2); ctx.rotate(player.angle);
    ctx.fillStyle="lime"; ctx.beginPath(); ctx.moveTo(15,0); ctx.lineTo(-10,-7); ctx.lineTo(-10,7); ctx.closePath(); ctx.fill(); ctx.restore();

    drawBorderEffect(); drawHUD(); if(minimapEnabled) drawMinimap();
  }

  function drawBorderEffect(){
    const maxEffectDistance=1000;
    const distToLeft=player.x+worldRadius;
    const distToRight=worldRadius-player.x;
    const distToTop=player.y+worldRadius;
    const distToBottom=worldRadius-player.y;
    const minDist=Math.min(distToLeft,distToRight,distToTop,distToBottom);
    if(minDist<maxEffectDistance){const opacity=1-minDist/maxEffectDistance; ctx.fillStyle=`rgba(128,0,128,${Math.max(0,Math.min(1,opacity))})`; ctx.fillRect(0,0,canvas.width,canvas.height);}
  }

  function drawHUD(){
    document.getElementById("velocidade").textContent="Velocidade: "+Math.hypot(player.vx,player.vy).toFixed(2);
    document.getElementById("coordX").textContent="X: "+player.x.toFixed(1);
    document.getElementById("coordY").textContent="Y: "+player.y.toFixed(1);
    const turboEl=document.getElementById("turbo");
    if(turboEnabled){turboEl.textContent="TURBO"; turboEl.style.color="deepskyblue";}
    else{turboEl.textContent=""; turboEl.style.color="";}
  }

  function drawMinimap(){
    const radius=100;
    const scale=radius/200000;
    const centerX=canvas.width-radius-20;
    const centerY=radius+20;

    ctx.save();
    ctx.beginPath();
    ctx.arc(centerX,centerY,radius,0,Math.PI*2);
    ctx.clip();

    ctx.fillStyle="rgba(0,0,0,0.7)";
    ctx.fillRect(centerX-radius,centerY-radius,radius*2,radius*2);

    // Draw suns
    for(let system of systems){
      const sun=system.sun;
      ctx.fillStyle=sun.color;
      ctx.beginPath();
      ctx.arc(centerX + (sun.x - player.x)*scale, centerY + (sun.y - player.y)*scale, Math.max(sun.radius*scale,3),0,Math.PI*2);
      ctx.fill();

      for(let planet of system.planets){
        const px=sun.x + planet.distance*Math.cos(planet.angle);
        const py=sun.y + planet.distance*Math.sin(planet.angle);
        ctx.fillStyle=planet.color;
        ctx.beginPath();
        ctx.arc(centerX + (px - player.x)*scale, centerY + (py - player.y)*scale, Math.max(planet.radius*scale,2),0,Math.PI*2);
        ctx.fill();
      }
    }

    ctx.fillStyle="lime";
    ctx.beginPath();
    ctx.arc(centerX,centerY,2.5,0,Math.PI*2);
    ctx.fill();
    ctx.restore();

    ctx.strokeStyle="white"; ctx.lineWidth=1;
    ctx.beginPath(); ctx.arc(centerX,centerY,radius,0,Math.PI*2); ctx.stroke();
  }

  function loop(){
    if(!paused){update(); draw();}
    requestAnimationFrame(loop);
  }

  loop();

  // Prevent double-tap zoom on mobile
  let lastTouch=0;
  document.addEventListener('touchend',(e)=>{
    const now=Date.now();
    if(now-lastTouch<=300) e.preventDefault();
    lastTouch=now;
  },{passive:false});
</script>
</body>
</html>
